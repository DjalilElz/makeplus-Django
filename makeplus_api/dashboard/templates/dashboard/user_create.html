{% extends 'dashboard/base.html' %}

{% block page_title %}Create User{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <div class="stat-card">
                <h4 class="mb-4"><i class="bi bi-person-plus"></i> Create New User</h4>
                
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label for="{{ form.email.id_for_label }}" class="form-label">Email *</label>
                        {{ form.email }}
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.first_name.id_for_label }}" class="form-label">First Name *</label>
                            {{ form.first_name }}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.last_name.id_for_label }}" class="form-label">Last Name *</label>
                            {{ form.last_name }}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.password.id_for_label }}" class="form-label">Password *</label>
                        {{ form.password }}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.event.id_for_label }}" class="form-label">Assign to Event *</label>
                        {{ form.event }}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.role.id_for_label }}" class="form-label">Role *</label>
                        {{ form.role }}
                    </div>
                    
                    <!-- Conditional: Room assignment for Gestionnaire des Salles and Controlleur -->
                    <div class="mb-3" id="roomAssignmentField" style="display: none;">
                        <label for="{{ form.assigned_room.id_for_label }}" class="form-label">
                            <i class="bi bi-door-open"></i> Assigned Room
                        </label>
                        {{ form.assigned_room }}
                        <small class="form-text text-muted">{{ form.assigned_room.help_text }}</small>
                    </div>
                    
                    <!-- Conditional: Profile Picture for Participants -->
                    <div class="mb-3" id="profilePictureField" style="display: none;">
                        <label for="{{ form.profile_picture_url.id_for_label }}" class="form-label">
                            <i class="bi bi-image"></i> Profile Picture URL (Optional)
                        </label>
                        {{ form.profile_picture_url }}
                        <small class="form-text text-muted">{{ form.profile_picture_url.help_text }}</small>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="bi bi-qr-code"></i> <strong>Note:</strong> A unique QR code will be automatically generated.
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'dashboard:user_list' %}" class="btn btn-outline-secondary">
                            <i class="bi bi-x-circle"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> Create User
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// Toggle conditional fields based on selected role
function toggleConditionalFields() {
    const roleSelect = document.querySelector('select[name="role"]');
    const selectedRole = roleSelect.value;
    
    const roomField = document.getElementById('roomAssignmentField');
    const profileField = document.getElementById('profilePictureField');
    
    // Show/hide room assignment for gestionnaire_des_salles and controlleur_des_badges
    if (selectedRole === 'gestionnaire_des_salles' || selectedRole === 'controlleur_des_badges') {
        roomField.style.display = 'block';
        profileField.style.display = 'none';
    } 
    // Show/hide profile picture for participant
    else if (selectedRole === 'participant') {
        roomField.style.display = 'none';
        profileField.style.display = 'block';
    } 
    // Hide both for other roles
    else {
        roomField.style.display = 'none';
        profileField.style.display = 'none';
    }
}

// Update room options when event changes (for future enhancement with dynamic loading)
function updateRoomOptions(eventId) {
    // For now, just inform user to save and select room
    // Future: Can add AJAX call to dynamically load rooms
    console.log('Event changed:', eventId);
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    toggleConditionalFields();
    
    // If event is already selected, load rooms
    const eventSelect = document.querySelector('select[name="event"]');
    if (eventSelect.value) {
        updateRoomOptions(eventSelect.value);
    }
});
</script>
{% endblock %}
